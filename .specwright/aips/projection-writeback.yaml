aip_id: AIP-life-cli-2025-12-09-001
context:
  background: 'The current pipeline is one-way:

    1. `lorchestra` pulls data from Dataverse → BigQuery → SQLite (`local.db`) → Markdown files

    2. Users can view and edit the markdown files in their vault

    3. There''s no way to push changes back to Dataverse


    The writeback feature closes this loop:

    1. **project** → populate `~/clinical-vault` + `local.db` with `projected_at` timestamp

    2. **edit markdown** → user modifies frontmatter (title, datetime, etc.)

    3. **writeback-plan** → detect changes by comparing file mtime vs `projected_at`

    4. **writeback-apply** → PATCH changes to Dataverse

    5. **project again** → reset everything to fresh state'
  constraints:
  - No edits to protected paths (`src/core/**`, `infra/**`)
  - Writeback does NOT update SQLite - projection is the only writer
  - 'Changes detected via: `file_mtime > projected_at + epsilon`'
created: '2025-12-09T16:05:53.242692+00:00'
meta:
  created_at: '2025-12-09T16:05:53.242692+00:00'
  created_by: benthepsychologist
objective:
  acceptance_criteria:
  - CI green (lint + unit)
  - '`life run writeback_plan` generates a plan file from changed markdown files'
  - '`life run writeback_apply` applies the plan to Dataverse'
  - 70% test coverage on new code
  goal: Implement projection writeback
orchestrator_contract:
  artifacts_dir: .aip_artifacts/AIP-life-cli-2025-12-09-001
  logging: jsonl
  state_machine:
    events:
    - run_step
    - await_gate
    - approve
    - reject
    - retry
    - escalate
    - complete
    states:
    - pending
    - running
    - awaiting_human
    - failed
    - succeeded
    - rolled_back
plan:
- description: Add `projected_at` to lorchestra (in `/workspace/lorchestra`)
  kind: code
  role: coding_agent
  step_id: step-001
- description: Implement `life_jobs.writeback` (in `/workspace/life-cli`)
  kind: code
  role: coding_agent
  step_id: step-002
- description: Job YAML Definitions
  kind: code
  role: coding_agent
  step_id: step-003
- description: Write unit tests for lorchestra and life-cli
  kind: code
  role: coding_agent
  step_id: step-004
- description: Validation
  kind: code
  role: coding_agent
  step_id: step-005
project_slug: life-cli
repo:
  default_branch: main
  url: git@github.com:benthepsychologist/life-cli.git
  working_branch: feat/projection-writeback
spec_version: 1.0.0
tier: C
title: projection writeback
updated: '2025-12-09T16:05:53.242692+00:00'
version: '0.1'

